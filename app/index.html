<!--
Copyright 2017 Next Century Corporation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<!doctype html>

<html lang="">

<head>
  <meta charset="utf-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="generator" content="Polymer Starter Kit" />
  <title>DIG</title>
  <!-- Place favicon.ico in the `app/` directory -->

  <!-- Chrome for Android theme color -->
  <meta name="theme-color" content="#2E3AA1">

  <!-- Web Application Manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- Tile color for Win8 -->
  <meta name="msapplication-TileColor" content="#3372DF">

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="PSK">
  <link rel="icon" sizes="192x192" href="images/touch/chrome-touch-icon-192x192.png">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Polymer Starter Kit">
  <link rel="apple-touch-icon" href="images/touch/apple-touch-icon.png">

  <!-- Tile icon for Win8 (144x144) -->
  <meta name="msapplication-TileImage" content="images/touch/ms-touch-icon-144x144-precomposed.png">

  <!-- build:css styles/main.css -->
  <!-- Must link leaflet css (https://github.com/leaflet-extras/leaflet-map/issues/46) -->
  <link rel="stylesheet" href="bower_components/leaflet/dist/leaflet.css">
  <link rel="stylesheet" href="styles/main.css">
  <!-- endbuild-->

  <!-- build:js bower_components/webcomponentsjs/webcomponents-lite.min.js -->
  <script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <!-- endbuild -->

  <!-- will be replaced with elements/elements.vulcanized.html -->
  <link rel="import" href="elements/elements.html">
  <!-- endreplace-->

  <link rel="import" href="styles/custom-icons.html">
  <link rel="import" href="styles/icon-styles.html">
  <link rel="import" href="styles/user-dialog-styles.html">
  <style is="custom-style" include="icon-styles"></style>
  <style is="custom-style" include="user-dialog-styles"></style>
</head>

<body unresolved class="fullbleed layout vertical">
  <span id="browser-sync-binding"></span>

  <template is="dom-bind" id="app">
    <!-- exposes clientConfig object which is a container for data
      transform functions -->
    <client-config config="{{clientConfig}}"></client-config>

    <!--get app configuration from server -->
    <iron-ajax
      auto
      url="/config"
      handle-as="json"
      last-response="{{config}}">
    </iron-ajax>

    <!--initialize new elastic client connection to server
      esclient can be used throughout the application lifecycle -->
    <elastic-client
      config="[[config.elasticConfig]]"
      client="{{esclient}}">
    </elastic-client>

    <query-builder demand
      description-field="[[descriptionConfig.queryField]]"
      location-field="[[locationConfig.queryField]]"
      money-field="[[moneyConfig.queryField]]"
      org-field="[[orgConfig.queryField]]"
      person-field="[[personConfig.queryField]]"
      product-field="[[productConfig.queryField]]"
      ticker-field="[[tickerConfig.queryField]]"
      title-field="[[titleConfig.queryField]]"
      url-field="[[urlConfig.queryField]]"
      search-parameters="[[searchParameters]]"
      query="{{wholeQuery}}">
    </query-builder>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[wholeQuery]]"
      page="{{pageNum}}"
      page-size="20"
      results="{{searchResults}}"
      last-error="{{searchError}}"
      aggregations="[]"
      filters="[]"
      loading="{{searchLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <!--
    <query-transformer
      error="{{searchError}}"
      loading="{{searchLoading}}"
      page="{{pageNum}}"
      page-size="20"
      process-request="[[processRequest]]"
      result-function="[[clientConfig.transforms.search.result]]"
      results="{{searchResults}}"
      search-parameters="[[searchParameters]]"
      search-function="[[clientConfig.transforms.search.search]]"
      url="[[config.queryUrl]]">
    </query-transformer>
    -->

    <json-transform
      data-in="{{searchResults}}"
      data-out="{{records}}"
      transform-function="[[clientConfig.transforms.doc.docs]]">
    </json-transform>

    <!-- Facets -->
    <query-builder demand
      ignore-type="location"
      description-field="[[descriptionConfig.queryField]]"
      location-field="[[locationConfig.queryField]]"
      money-field="[[moneyConfig.queryField]]"
      org-field="[[orgConfig.queryField]]"
      person-field="[[personConfig.queryField]]"
      product-field="[[productConfig.queryField]]"
      ticker-field="[[tickerConfig.queryField]]"
      title-field="[[titleConfig.queryField]]"
      url-field="[[urlConfig.queryField]]"
      search-parameters="[[searchParameters]]"
      query="{{locationQuery}}">
    </query-builder>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[locationQuery]]"
      page-size="0"
      results="{{locationResult}}"
      last-error="{{locationError}}"
      aggregations="{{buildArray(locationAgg)}}"
      filters="[]"
      loading="{{locationLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <query-builder demand
      ignore-type="money"
      description-field="[[descriptionConfig.queryField]]"
      location-field="[[locationConfig.queryField]]"
      money-field="[[moneyConfig.queryField]]"
      org-field="[[orgConfig.queryField]]"
      person-field="[[personConfig.queryField]]"
      product-field="[[productConfig.queryField]]"
      ticker-field="[[tickerConfig.queryField]]"
      title-field="[[titleConfig.queryField]]"
      url-field="[[urlConfig.queryField]]"
      search-parameters="[[searchParameters]]"
      query="{{moneyQuery}}">
    </query-builder>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[moneyQuery]]"
      page-size="0"
      results="{{moneyResult}}"
      last-error="{{moneyError}}"
      aggregations="{{buildArray(moneyAgg)}}"
      filters="[]"
      loading="{{moneyLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <query-builder demand
      ignore-type="org"
      description-field="[[descriptionConfig.queryField]]"
      location-field="[[locationConfig.queryField]]"
      money-field="[[moneyConfig.queryField]]"
      org-field="[[orgConfig.queryField]]"
      person-field="[[personConfig.queryField]]"
      product-field="[[productConfig.queryField]]"
      ticker-field="[[tickerConfig.queryField]]"
      title-field="[[titleConfig.queryField]]"
      url-field="[[urlConfig.queryField]]"
      search-parameters="[[searchParameters]]"
      query="{{orgQuery}}">
    </query-builder>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[orgQuery]]"
      page-size="0"
      results="{{orgResult}}"
      last-error="{{orgError}}"
      aggregations="{{buildArray(orgAgg)}}"
      filters="[]"
      loading="{{orgLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <query-builder demand
      ignore-type="person"
      description-field="[[descriptionConfig.queryField]]"
      location-field="[[locationConfig.queryField]]"
      money-field="[[moneyConfig.queryField]]"
      org-field="[[orgConfig.queryField]]"
      person-field="[[personConfig.queryField]]"
      product-field="[[productConfig.queryField]]"
      ticker-field="[[tickerConfig.queryField]]"
      title-field="[[titleConfig.queryField]]"
      url-field="[[urlConfig.queryField]]"
      search-parameters="[[searchParameters]]"
      query="{{personQuery}}">
    </query-builder>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[personQuery]]"
      page-size="0"
      results="{{personResult}}"
      last-error="{{personError}}"
      aggregations="{{buildArray(personAgg)}}"
      filters="[]"
      loading="{{personLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <query-builder demand
      ignore-type="product"
      description-field="[[descriptionConfig.queryField]]"
      location-field="[[locationConfig.queryField]]"
      money-field="[[moneyConfig.queryField]]"
      org-field="[[orgConfig.queryField]]"
      person-field="[[personConfig.queryField]]"
      product-field="[[productConfig.queryField]]"
      ticker-field="[[tickerConfig.queryField]]"
      title-field="[[titleConfig.queryField]]"
      url-field="[[urlConfig.queryField]]"
      search-parameters="[[searchParameters]]"
      query="{{productQuery}}">
    </query-builder>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[productQuery]]"
      page-size="0"
      results="{{productResult}}"
      last-error="{{productError}}"
      aggregations="{{buildArray(productAgg)}}"
      filters="[]"
      loading="{{productLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <query-builder demand
      ignore-type="ticker"
      description-field="[[descriptionConfig.queryField]]"
      location-field="[[locationConfig.queryField]]"
      money-field="[[moneyConfig.queryField]]"
      org-field="[[orgConfig.queryField]]"
      person-field="[[personConfig.queryField]]"
      product-field="[[productConfig.queryField]]"
      ticker-field="[[tickerConfig.queryField]]"
      title-field="[[titleConfig.queryField]]"
      url-field="[[urlConfig.queryField]]"
      search-parameters="[[searchParameters]]"
      query="{{tickerQuery}}">
    </query-builder>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[tickerQuery]]"
      page-size="0"
      results="{{tickerResult}}"
      last-error="{{tickerError}}"
      aggregations="{{buildArray(tickerAgg)}}"
      filters="[]"
      loading="{{tickerLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>

    <!--
    <query-builder demand
      ignore-type="url"
      description-field="[[descriptionConfig.queryField]]"
      location-field="[[locationConfig.queryField]]"
      money-field="[[moneyConfig.queryField]]"
      org-field="[[orgConfig.queryField]]"
      person-field="[[personConfig.queryField]]"
      product-field="[[productConfig.queryField]]"
      ticker-field="[[tickerConfig.queryField]]"
      title-field="[[titleConfig.queryField]]"
      url-field="[[urlConfig.queryField]]"
      search-parameters="[[searchParameters]]"
      query="{{urlQuery}}">
    </query-builder>

    <elastic-client-search
      client="[[esclient]]"
      index="[[config.elasticIndex]]"
      elastic-types="[[getElasticTypes()]]"
      query="[[urlQuery]]"
      page-size="0"
      results="{{urlResult}}"
      last-error="{{urlError}}"
      aggregations="{{buildArray(urlAgg)}}"
      filters="[]"
      loading="{{urlLoading}}"
      properties-ready="{{processRequest}}">
    </elastic-client-search>
    -->
    <!-- End Facets -->

    <paper-header-panel class="flex" mode="waterfall">

      <!-- Search toolbar -->
      <paper-toolbar id="navbar">
        <img class="bottom" src="images/dig-logo-original.png" alt="">
        <div class="bottom drawer-spacer"></div>

        <div class="bottom v-divider"></div>

        <div class="white-input-container bottom flex">
          <paper-button class="layout horizontal center bottom green" active="[[searchFieldsDialogOpened]]" on-tap="toggleSearchFieldsDialog" title="Click to Enter Search Terms">
            <iron-icon icon="search" class="bottom" style="margin-right: 5px;"></iron-icon>
            <span class="search-options-title">Click to Enter Search Terms</span>
          </paper-button>
        </div>

        <a class="bottom" href="." style="color: #ffffff;">
          <paper-icon-button icon="clear" title="Reset Page"></paper-icon-button>
        </a>
      </paper-toolbar>

      <!-- search fields dropdown panel -->
      <paper-dialog
        class="small"
        modal
        opened="{{searchFieldsDialogOpened}}"
        entry-animation="fade-in-animation"
        exit-animation="fade-out-animation"
        on-opened-changed="toggleProcessRequest">

        <div class="search-fields-dialog">
          <!-- searchFields -->
          <div class="layout horizontal">
            <div class="layout vertical right-space search-labels">
              <div class="name instructions">Instructions:</div>
              <!--
              <div class="name date">Dates:</div>
              -->
              <div class="name rows-2">Fields:</div>
            </div>

            <div class="layout vertical">
              <div class="text">
                Enter words or phrases as search terms in one or more of the text fields below.
                Click the Search button or press ENTER when finished.
                Use commas to separate search terms.
                Example:  <strong>New York, Washington</strong>
              </div>

              <!--
              <div class="layout horizontal date-fields-container">
                <date-picker-display
                  facet-selection="{{dateStartConfig.value}}"
                  key="{{dateStartConfig.key}}"
                  prefix-label="{{dateStartConfig.prefixLabel}}"
                  date-identifier="{{dateStartConfig.dateIdentifier}}"
                  title="{{dateStartConfig.title}}">
                </date-picker-display>
                <date-picker-display
                  facet-selection="{{dateEndConfig.value}}"
                  key="{{dateEndConfig.key}}"
                  prefix-label="{{dateEndConfig.prefixLabel}}"
                  date-identifier="{{dateEndConfig.dateIdentifier}}"
                  title="{{dateEndConfig.title}}">
                </date-picker-display>
              </div>
              -->

              <div class="layout horizontal wrap" style="padding-top: 15px;">
                <paper-input
                  id$="input_[[tickerConfig.key]]"
                  label="[[tickerConfig.title]]"
                  value="{{tickerConfig.value}}"
                  on-keydown="checkSearchFieldInputKey">
                </paper-input>
                <paper-input
                  id$="input_[[productConfig.key]]"
                  label="[[productConfig.title]]"
                  value="{{productConfig.value}}"
                  on-keydown="checkSearchFieldInputKey">
                </paper-input>
                <paper-input
                  id$="input_[[personConfig.key]]"
                  label="[[personConfig.title]]"
                  value="{{personConfig.value}}"
                  on-keydown="checkSearchFieldInputKey">
                </paper-input>
                <paper-input
                  id$="input_[[orgConfig.key]]"
                  label="[[orgConfig.title]]"
                  value="{{orgConfig.value}}"
                  on-keydown="checkSearchFieldInputKey">
                </paper-input>
                <paper-input
                  id$="input_[[moneyConfig.key]]"
                  label="[[moneyConfig.title]]"
                  value="{{moneyConfig.value}}"
                  on-keydown="checkSearchFieldInputKey">
                </paper-input>
                <paper-input
                  id$="input_[[locationConfig.key]]"
                  label="[[locationConfig.title]]"
                  value="{{locationConfig.value}}"
                  on-keydown="checkSearchFieldInputKey">
                </paper-input>
                <!--<paper-input
                  id$="input_[[urlConfig.key]]"
                  label="[[urlConfig.title]]"
                  value="{{urlConfig.value}}"
                  on-keydown="checkSearchFieldInputKey">
                </paper-input>-->
                <paper-input
                  id$="input_[[titleConfig.key]]"
                  label="[[titleConfig.title]]"
                  value="{{titleConfig.value}}"
                  on-keydown="checkSearchFieldInputKey">
                </paper-input>
                <paper-input
                  id$="input_[[descriptionConfig.key]]"
                  label="[[descriptionConfig.title]]"
                  value="{{descriptionConfig.value}}"
                  on-keydown="checkSearchFieldInputKey">
                </paper-input>
              </div>
            </div>
          </div>

          <div class="horizontal layout center-justified search-buttons">
            <button-action class="inline" text="Search" on-tap="handleSearch"></button-action>
            <button-action class="inline" text="Reset" on-tap="resetSearchFields"></button-action>
            <button-action class="inline" text="Cancel" on-tap="cancelSearch"></button-action>
          </div>
        </div>
      </paper-dialog>

      <paper-drawer-panel drawer-width="320px">

        <!-- Sidebar on left side -->
        <paper-header-panel drawer>
          <paper-toolbar class="drawer-header">
            <div class="layout vertical">
              <div class="h-divider"></div>

              <template is="dom-if" if="[[!noSearchParameters(searchParameters.*)]]">
                <div class="selected-facets-header">Search Terms</div>
              </template>

              <template is="dom-if" if="[[noSearchParameters(searchParameters.*)]]">
                <div class="selected-facets-header">No Search Terms</div>
              </template>

              <!-- Ensure that facet interactions still work after user hits cancel in search dialog -->
              <!-- TODO: move to component as observer when index.html is cleaned up -->
              <span>{{toggleProcessRequest(searchParameters.*)}}</span>

              <div class="layout horizontal wrap">
                <!-- Nesting keys for start and end dates under postingDate to be consistent with how other -->
                <!-- facetSelections are represented. -->
                <selected-facets-display facet-selection="{{searchParameters.postingDate}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.ticker}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.product}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.person}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.org}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.money}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.location}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.title}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.description}}"></selected-facets-display>
                <selected-facets-display facet-selection="{{searchParameters.url}}"></selected-facets-display>
              </div>

              <div class="h-divider"></div>
            </div>
          </paper-toolbar>

          <iron-pages attr-for-selected="data-type" selected="microcap">
            <section data-type="microcap">
              <div class="layout horizontal facet filter-header" title="Toggle All Facets" on-tap="toggleAllFacetLists">
                <span class="flex">Facets</span>
                <span>[[getToggleAllFacetsText(facetListsExpanded)]]</span>
                <iron-icon icon="[[getToggleAllFacetsIcon(facetListsExpanded)]]"</iron-icon>
              </div>

              <!--
              <div class="h-divider"></div>

              <div id="date" class="layout horizontal facet filter-header" title="Toggle Dates" on-tap="toggleList">
                <span class="flex">Date</span>
                <iron-icon id="date-icon-opened" icon="icons:expand-less"></iron-icon>
                <iron-icon id="date-icon-closed" icon="icons:expand-more" style="display: none;"></iron-icon>
              </div>

              <iron-collapse id="date-list" class="filter-list" opened>
                <date-picker-display
                  facet-selection="{{searchParameters.postingDate}}"
                  key="[[dateStartConfig.key]]"
                  title="[[dateStartConfig.title]]"
                  prefix-label="[[dateStartConfig.prefixLabel]]"
                  date-identifier="[[dateStartConfig.dateIdentifier]]">
                </date-picker-display>

                <date-picker-display
                  facet-selection="{{searchParameters.postingDate}}"
                  key="[[dateEndConfig.key]]"
                  title="[[dateEndConfig.title]]"
                  prefix-label="[[dateEndConfig.prefixLabel]]"
                  date-identifier="[[dateEndConfig.dateIdentifier]]">
                </date-picker-display>
              </iron-collapse>
              -->

              <div class="h-divider"></div>

              <div id="ticker-symbol" class="layout horizontal facet filter-header" title="Toggle [[tickerConfig.title]]" on-tap="toggleList">
                <span class="flex">[[getLabelAndCount(tickerConfig.title, tickerResultList)]]</span>
                <iron-icon id="ticker-symbol-icon-opened" icon="icons:expand-less"></iron-icon>
                <iron-icon id="ticker-symbol-icon-closed" icon="icons:expand-more" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="[[tickerConfig.key]]"
                field="[[tickerConfig.aggregationField]]"
                count="{{tickerCount}}"
                ejs-aggregation="{{tickerAgg}}"
                type="terms"
                order="{{tickerSortOrder}}">
              </elastic-client-aggregation-builder>

              <json-combine
                data-in1="[[tickerResult]]"
                data-in2="[[tickerConfig.key]]"
                data-out="{{tickerResultList}}"
                combine-function="[[clientConfig.transforms.filterAggs.filterList]]">
              </json-combine>

              <terms-transformer
                category="[[tickerConfig.title]]"
                list="{{tickerSelectedList}}"
                object="{{searchParameters.ticker}}">
              </terms-transformer>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <aggregation-popup
                    aggregation-count="{{tickerCount}}"
                    items="[[tickerResultList]]"
                    error="[[tickerError]]"
                    loading="[[tickerLoading]]"
                    item-type="[[tickerConfig.title]]"
                    count-type="Documents"
                    text-property="id"
                    order-by="{{tickerSortOrder}}"
                    selected-ids="{{tickerSelectedList}}">
                  </aggregation-popup>
                </div>
                <template is="dom-if" if="[[tickerResultList.length]]">
                  <div class="self-end">
                    <aggregation-sort order-by="{{tickerSortOrder}}"></aggregation-sort>
                  </div>
                </template>
              </div>

              <select-all
                list="[[tickerResultList]]"
                loading="[[tickerLoading]]"
                selected="{{tickerSelectedList}}">
              </select-all>

              <iron-collapse id="ticker-symbol-list" class="filter-list" opened>
                <feature-aggregation show-checkboxes
                  checkbox-name="Search"
                  hide-no-data-text hide-show-more small
                  text-property="id"
                  items="[[tickerResultList]]"
                  selected-ids="{{tickerSelectedList}}">
                </feature-aggregation>
                <elastic-error error="[[tickerError]]" message="{{tickerErrorMessage}}"></elastic-error>
                <status-text
                  count="[[tickerResultList.length]]"
                  error="[[tickerErrorMessage]]"
                  loading="[[tickerLoading]]"
                  empty="No [[tickerConfig.title]]">
                </status-text>
              </iron-collapse>

              <div class="h-divider"></div>

              <div id="product" class="layout horizontal facet filter-header" title="Toggle [[productConfig.title]]" on-tap="toggleList">
                <span class="flex">[[getLabelAndCount(productConfig.title, productResultList)]]</span>
                <iron-icon id="product-icon-opened" icon="icons:expand-less"></iron-icon>
                <iron-icon id="product-icon-closed" icon="icons:expand-more" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="[[productConfig.key]]"
                field="[[productConfig.aggregationField]]"
                count="{{productCount}}"
                ejs-aggregation="{{productAgg}}"
                type="terms"
                order="{{productSortOrder}}">
              </elastic-client-aggregation-builder>

              <json-combine
                data-in1="[[productResult]]"
                data-in2="[[productConfig.key]]"
                data-out="{{productResultList}}"
                combine-function="[[clientConfig.transforms.filterAggs.filterList]]">
              </json-combine>

              <terms-transformer
                category="[[productConfig.title]]"
                list="{{productSelectedList}}"
                object="{{searchParameters.product}}">
              </terms-transformer>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <aggregation-popup
                    aggregation-count="{{productCount}}"
                    items="[[productResultList]]"
                    error="[[productError]]"
                    loading="[[productLoading]]"
                    item-type="[[productConfig.title]]"
                    count-type="Documents"
                    text-property="id"
                    order-by="{{productSortOrder}}"
                    selected-ids="{{productSelectedList}}">
                  </aggregation-popup>
                </div>
                <template is="dom-if" if="[[productResultList.length]]">
                  <div class="self-end">
                    <aggregation-sort order-by="{{productSortOrder}}"></aggregation-sort>
                  </div>
                </template>
              </div>

              <select-all
                list="[[productResultList]]"
                loading="[[productLoading]]"
                selected="{{productSelectedList}}">
              </select-all>

              <iron-collapse id="product-list" class="filter-list" opened>
                <feature-aggregation show-checkboxes
                  checkbox-name="Search"
                  hide-no-data-text hide-show-more small
                  text-property="id"
                  items="[[productResultList]]"
                  selected-ids="{{productSelectedList}}">
                </feature-aggregation>
                <elastic-error error="[[productError]]" message="{{productErrorMessage}}"></elastic-error>
                <status-text
                  count="[[productResultList.length]]"
                  error="[[productErrorMessage]]"
                  loading="[[productLoading]]"
                  empty="No [[productConfig.title]]">
                </status-text>
              </iron-collapse>

              <div class="h-divider"></div>

              <div id="person" class="layout horizontal facet filter-header" title="Toggle [[personConfig.title]]" on-tap="toggleList">
                <span class="flex">[[getLabelAndCount(personConfig.title, personResultList)]]</span>
                <iron-icon id="person-icon-opened" icon="icons:expand-less"></iron-icon>
                <iron-icon id="person-icon-closed" icon="icons:expand-more" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="[[personConfig.key]]"
                field="[[personConfig.aggregationField]]"
                count="{{personCount}}"
                ejs-aggregation="{{personAgg}}"
                type="terms"
                order="{{personSortOrder}}">
              </elastic-client-aggregation-builder>

              <json-combine
                data-in1="[[personResult]]"
                data-in2="[[personConfig.key]]"
                data-out="{{personResultList}}"
                combine-function="[[clientConfig.transforms.filterAggs.filterList]]">
              </json-combine>

              <terms-transformer
                category="[[personConfig.title]]"
                list="{{personSelectedList}}"
                object="{{searchParameters.person}}">
              </terms-transformer>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <aggregation-popup
                    aggregation-count="{{personCount}}"
                    items="[[personResultList]]"
                    error="[[personError]]"
                    loading="[[personLoading]]"
                    item-type="[[personConfig.title]]"
                    count-type="Documents"
                    text-property="id"
                    order-by="{{personSortOrder}}"
                    selected-ids="{{personSelectedList}}">
                  </aggregation-popup>
                </div>
                <template is="dom-if" if="[[personResultList.length]]">
                  <div class="self-end">
                    <aggregation-sort order-by="{{personSortOrder}}"></aggregation-sort>
                  </div>
                </template>
              </div>

              <select-all
                list="[[personResultList]]"
                loading="[[personLoading]]"
                selected="{{personSelectedList}}">
              </select-all>

              <iron-collapse id="person-list" class="filter-list" opened>
                <feature-aggregation show-checkboxes
                  checkbox-name="Search"
                  hide-no-data-text hide-show-more small
                  text-property="id"
                  items="[[personResultList]]"
                  selected-ids="{{personSelectedList}}">
                </feature-aggregation>
                <elastic-error error="[[personError]]" message="{{personErrorMessage}}"></elastic-error>
                <status-text
                  count="[[personResultList.length]]"
                  error="[[personErrorMessage]]"
                  loading="[[personLoading]]"
                  empty="No [[personConfig.title]]">
                </status-text>
              </iron-collapse>

              <div class="h-divider"></div>

              <div id="org" class="layout horizontal facet filter-header" title="Toggle [[orgConfig.title]]" on-tap="toggleList">
                <span class="flex">[[getLabelAndCount(orgConfig.title, orgResultList)]]</span>
                <iron-icon id="org-icon-opened" icon="icons:expand-less"></iron-icon>
                <iron-icon id="org-icon-closed" icon="icons:expand-more" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="[[orgConfig.key]]"
                field="[[orgConfig.aggregationField]]"
                count="{{orgCount}}"
                ejs-aggregation="{{orgAgg}}"
                type="terms"
                order="{{orgSortOrder}}">
              </elastic-client-aggregation-builder>

              <json-combine
                data-in1="[[orgResult]]"
                data-in2="[[orgConfig.key]]"
                data-out="{{orgResultList}}"
                combine-function="[[clientConfig.transforms.filterAggs.filterList]]">
              </json-combine>

              <terms-transformer
                category="[[orgConfig.title]]"
                list="{{orgSelectedList}}"
                object="{{searchParameters.org}}">
              </terms-transformer>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <aggregation-popup
                    aggregation-count="{{orgCount}}"
                    items="[[orgResultList]]"
                    error="[[orgError]]"
                    loading="[[orgLoading]]"
                    item-type="[[orgConfig.title]]"
                    count-type="Documents"
                    text-property="id"
                    order-by="{{orgSortOrder}}"
                    selected-ids="{{orgSelectedList}}">
                  </aggregation-popup>
                </div>
                <template is="dom-if" if="[[orgResultList.length]]">
                  <div class="self-end">
                    <aggregation-sort order-by="{{orgSortOrder}}"></aggregation-sort>
                  </div>
                </template>
              </div>

              <select-all
                list="[[orgResultList]]"
                loading="[[orgLoading]]"
                selected="{{orgSelectedList}}">
              </select-all>

              <iron-collapse id="org-list" class="filter-list" opened>
                <feature-aggregation show-checkboxes
                  checkbox-name="Search"
                  hide-no-data-text hide-show-more small
                  text-property="id"
                  items="[[orgResultList]]"
                  selected-ids="{{orgSelectedList}}">
                </feature-aggregation>
                <elastic-error error="[[orgError]]" message="{{orgErrorMessage}}"></elastic-error>
                <status-text
                  count="[[orgResultList.length]]"
                  error="[[orgErrorMessage]]"
                  loading="[[orgLoading]]"
                  empty="No [[orgConfig.title]]">
                </status-text>
              </iron-collapse>

              <div class="h-divider"></div>

              <div id="money" class="layout horizontal facet filter-header" title="Toggle [[moneyConfig.title]]" on-tap="toggleList">
                <span class="flex">[[getLabelAndCount(moneyConfig.title, moneyResultList)]]</span>
                <iron-icon id="money-icon-opened" icon="icons:expand-less"></iron-icon>
                <iron-icon id="money-icon-closed" icon="icons:expand-more" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="[[moneyConfig.key]]"
                field="[[moneyConfig.aggregationField]]"
                count="{{moneyCount}}"
                ejs-aggregation="{{moneyAgg}}"
                type="terms"
                order="{{moneySortOrder}}">
              </elastic-client-aggregation-builder>

              <json-combine
                data-in1="[[moneyResult]]"
                data-in2="[[moneyConfig.key]]"
                data-out="{{moneyResultList}}"
                combine-function="[[clientConfig.transforms.filterAggs.filterList]]">
              </json-combine>

              <terms-transformer
                category="[[moneyConfig.title]]"
                list="{{moneySelectedList}}"
                object="{{searchParameters.money}}">
              </terms-transformer>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <aggregation-popup
                    aggregation-count="{{moneyCount}}"
                    items="[[moneyResultList]]"
                    error="[[moneyError]]"
                    loading="[[moneyLoading]]"
                    item-type="[[moneyConfig.title]]"
                    count-type="Docs"
                    order-by="{{moneySortOrder}}"
                    selected-ids="{{moneySelectedList}}">
                  </aggregation-popup>
                </div>
                <template is="dom-if" if="[[moneyResultList.length]]">
                  <div class="self-end">
                    <aggregation-sort order-by="{{moneySortOrder}}"></aggregation-sort>
                  </div>
                </template>
              </div>

              <select-all
                list="[[moneyResultList]]"
                loading="[[moneyLoading]]"
                selected="{{moneySelectedList}}">
              </select-all>

              <iron-collapse id="money-list" class="filter-list" opened>
                <feature-aggregation show-checkboxes
                  checkbox-name="Search"
                  hide-no-data-text hide-show-more small
                  text-property="id"
                  items="[[moneyResultList]]"
                  selected-ids="{{moneySelectedList}}">
                </feature-aggregation>
                <elastic-error error="[[moneyError]]" message="{{moneyErrorMessage}}"></elastic-error>
                <status-text
                  count="[[moneyResultList.length]]"
                  error="[[moneyErrorMessage]]"
                  loading="[[moneyLoading]]"
                  empty="No [[moneyConfig.title]]">
                </status-text>
              </iron-collapse>

              <div class="h-divider"></div>

              <div id="location" class="layout horizontal facet filter-header" title="Toggle [[locationConfig.title]]" on-tap="toggleList">
                <span class="flex">[[getLabelAndCount(locationConfig.title, locationResultList)]]</span>
                <iron-icon id="location-icon-opened" icon="icons:expand-less"></iron-icon>
                <iron-icon id="location-icon-closed" icon="icons:expand-more" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="[[locationConfig.key]]"
                field="[[locationConfig.aggregationField]]"
                count="{{locationCount}}"
                ejs-aggregation="{{locationAgg}}"
                type="terms"
                order="{{locationSortOrder}}">
              </elastic-client-aggregation-builder>

              <json-combine
                data-in1="[[locationResult]]"
                data-in2="[[locationConfig.key]]"
                data-out="{{locationResultList}}"
                combine-function="[[clientConfig.transforms.filterAggs.filterList]]">
              </json-combine>

              <terms-transformer
                category="[[locationConfig.title]]"
                list="{{locationSelectedList}}"
                object="{{searchParameters.location}}">
              </terms-transformer>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <aggregation-popup
                    aggregation-count="{{locationCount}}"
                    items="[[locationResultList]]"
                    error="[[locationError]]"
                    loading="[[locationLoading]]"
                    item-type="[[locationConfig.title]]"
                    count-type="Documents"
                    text-property="id"
                    order-by="{{locationSortOrder}}"
                    selected-ids="{{locationSelectedList}}">
                  </aggregation-popup>
                </div>
                <div class="self-end">
                  <template is="dom-if" if="[[locationResultList.length]]">
                    <aggregation-sort order-by="{{locationSortOrder}}"></aggregation-sort>
                  </template>
                </div>
              </div>

              <select-all
                list="[[locationResultList]]"
                loading="[[locationLoading]]"
                selected="{{locationSelectedList}}">
              </select-all>

              <iron-collapse id="location-list" class="filter-list" opened>
                <feature-aggregation show-checkboxes
                  checkbox-name="Search"
                  hide-no-data-text hide-show-more small
                  text-property="id"
                  items="[[locationResultList]]"
                  selected-ids="{{locationSelectedList}}">
                </feature-aggregation>
                <elastic-error error="[[locationError]]" message="{{locationErrorMessage}}"></elastic-error>
                <status-text
                  count="[[locationResultList.length]]"
                  error="[[locationErrorMessage]]"
                  loading="[[locationLoading]]"
                  empty="No [[locationConfig.title]]">
                </status-text>
              </iron-collapse>

              <!--<div class="h-divider"></div>

              <div id="url" class="layout horizontal facet filter-header" title="Toggle [[urlConfig.title]]" on-tap="toggleList">
                <span class="flex">[[getLabelAndCount(urlConfig.title, urlResultList)]]</span>
                <iron-icon id="url-icon-opened" icon="icons:expand-less"></iron-icon>
                <iron-icon id="url-icon-closed" icon="icons:expand-more" style="display: none;"></iron-icon>
              </div>

              <elastic-client-aggregation-builder
                name="[[urlConfig.key]]"
                field="[[urlConfig.aggregationField]]"
                count="{{urlCount}}"
                ejs-aggregation="{{urlAgg}}"
                type="terms"
                order="{{urlSortOrder}}">
              </elastic-client-aggregation-builder>

              <json-combine
                data-in1="[[urlResult]]"
                data-in2="[[urlConfig.key]]"
                data-out="{{urlResultList}}"
                combine-function="[[clientConfig.transforms.filterAggs.filterList]]">
              </json-combine>

              <terms-transformer
                category="[[urlConfig.title]]"
                list="{{urlSelectedList}}"
                object="{{searchParameters.url}}">
              </terms-transformer>

              <div class="horizontal layout">
                <div class="flex self-start">
                  <aggregation-popup
                    aggregation-count="{{urlCount}}"
                    items="[[urlResultList]]"
                    error="[[urlError]]"
                    loading="[[urlLoading]]"
                    item-type="[[urlConfig.title]]"
                    count-type="Documents"
                    text-property="id"
                    order-by="{{urlSortOrder}}"
                    selected-ids="{{urlSelectedList}}">
                  </aggregation-popup>
                </div>
                <template is="dom-if" if="[[urlResultList.length]]">
                  <div class="self-end">
                    <aggregation-sort order-by="{{urlSortOrder}}"></aggregation-sort>
                  </div>
                </template>
              </div>

              <select-all
                list="[[urlResultList]]"
                loading="[[urlLoading]]"
                selected="{{urlSelectedList}}">
              </select-all>

              <iron-collapse id="url-list" class="filter-list" opened>
                <feature-aggregation show-checkboxes
                  checkbox-name="Search"
                  hide-no-data-text hide-show-more small
                  text-property="id"
                  items="[[urlResultList]]"
                  selected-ids="{{urlSelectedList}}">
                </feature-aggregation>
                <elastic-error error="[[urlError]]" message="{{urlErrorMessage}}"></elastic-error>
                <status-text
                  count="[[urlResultList.length]]"
                  error="[[urlErrorMessage]]"
                  loading="[[urlLoading]]"
                  empty="No [[urlConfig.title]]">
                </status-text>
              </iron-collapse>-->
            </section>

            <section data-type="image"></section>
          </iron-pages>
        </paper-header-panel>

        <!-- Main content on right side -->
        <paper-header-panel main id="searchPanel">
          <div id="searchTitle" class="layout horizontal">
            <template is="dom-if" if="[[!searchError]]">
              <div class="paper-font-title flex">[[recordsListTitle]]</div>
            </template>

            <template is="dom-if" if="[[searchError]]">
              <elastic-error error="[[searchError]]" message="{{searchErrorMessage}}"></elastic-error>
              <div class="paper-font-title flex">
                [[searchErrorMessage]]
              </div>
            </template>

            <export-button
              data="[[shownRecords]]"
              download-image-url="[[config.downloadImageUrl]]"
              csv-transform-function="[[clientConfig.transforms.doc.createExportDataForCsv]]"
              pdf-transform-function="[[clientConfig.transforms.doc.createExportDataForPdf]]">
            </export-button>
          </div>

          <records-list id="searchResults"
            client="[[esclient]]"
            new-tab="true"
            item-name-property="title"
            query-results="{{records.data}}"
            total-results="{{records.count}}"
            shown-results="{{shownRecords}}"
            page="{{pageNum}}"
            page-size="20"
            loading="{{searchLoading}}"
            type="Result"
            records-list-title="{{recordsListTitle}}">
          </records-list>
        </paper-header-panel>

      </paper-drawer-panel>

    </paper-header-panel>

  </template>

  <!-- Need to include dependencies here for IE -->
  <script src="bower_components/lodash/dist/lodash.js"></script>
  <script src="behaviors/array-behavior.js"></script>
  <script src="behaviors/browser-behavior.js"></script>
  <script src="behaviors/filter-behavior.js"></script>
  <script src="behaviors/phone-behavior.js"></script>
  <script src="behaviors/state-behavior.js"></script>

  <script>
    (function(document) {
      /* globals _, DigBehaviors */
      var app = document.querySelector('#app');

      app.facetListsExpanded = true;

      app.searchParameters = DigBehaviors.StateBehavior.buildSearchState({});

      app.params = DigBehaviors.BrowserBehavior.getUrlParameters(window.location.search);

      app.buildArray = DigBehaviors.ArrayBehavior.buildArray;

      app.dateStartConfig = {
        key: 'dateStart',
        title: 'From',
        queryField: 'fields.posting_date.strict.name',
        aggregationField: 'fields.posting_date.strict.name',
        value: {},
        prefixLabel: 'From',
        dateIdentifier: 'start'
      };
      app.dateEndConfig = {
        key: 'dateEnd',
        title: 'To',
        queryField: 'fields.posting_date.strict.name',
        aggregationField: 'fields.posting_date.strict.name',
        value: {},
        prefixLabel: 'To',
        dateIdentifier: 'end'
      };
      app.descriptionConfig = {
        key: 'description',
        title: 'Content',
        queryField: 'fields.content.strict.name',
        aggregationField: 'fields.content.strict.key',
        value: ''
      };
      app.locationConfig = {
        key: 'location',
        title: 'Location',
        queryField: 'fields.location.strict.name',
        aggregationField: 'fields.location.strict.key',
        value: ''
      };
      app.moneyConfig = {
        key: 'money',
        title: 'Money',
        queryField: 'fields.money.strict.name',
        aggregationField: 'fields.money.strict.key',
        value: ''
      };
      app.orgConfig = {
        key: 'org',
        title: 'Organization',
        queryField: 'fields.org.strict.name',
        aggregationField: 'fields.org.strict.key',
        value: ''
      };
      app.personConfig = {
        key: 'person',
        title: 'Person',
        queryField: 'fields.person.strict.name',
        aggregationField: 'fields.person.strict.key',
        value: ''
      };
      app.productConfig = {
        key: 'product',
        title: 'Product',
        queryField: 'fields.product.strict.name',
        aggregationField: 'fields.product.strict.key',
        value: ''
      };
      app.tickerConfig = {
        key: 'ticker',
        title: 'Ticker',
        queryField: 'fields.ticker.strict.name',
        aggregationField: 'fields.ticker.strict.key',
        value: ''
      };
      app.titleConfig = {
        key: 'title',
        title: 'Title',
        queryField: 'fields.title.strict.name',
        aggregationField: 'fields.title.strict.key',
        value: ''
      };
      app.urlConfig = {
        key: 'url',
        title: 'Url',
        queryField: 'fields.url.strict.name',
        aggregationField: 'fields.url.strict.key',
        value: ''
      };

      app.userCanceled = false;

      app.searchFields = [
        app.moneyConfig,
        app.descriptionConfig,
        app.personConfig,
        app.locationConfig,
        app.productConfig,
        app.orgConfig,
        app.tickerConfig,
        app.titleConfig
      ];

      app.updateSearchParameterAndNotify = function(type, term, title, enabled) {
        this.searchParameters[type][term] = {
          category: title,
          enabled: enabled,
          key: term,
          text: term
        };

        this.notifyPath(['searchParameters', type, '*'], {
          category: title,
          enabled: enabled,
          key: term,
          text: term
        });
      };

      app.updateSearchParameterFromField = function(searchConfig) {
        var terms = searchConfig.value.split(',').map(function(term) {
          if(searchConfig.key === 'phone') {
            return DigBehaviors.PhoneBehavior.getUnformattedPhones(term);
          }
          if(searchConfig.key === 'risk') {
            return term === 'Yes' || term === 'No' ? term.toLowerCase() : '';
          }
          return term.trim();
        });

        _.keys(app.searchParameters[searchConfig.key]).forEach(function(term) {
          if(app.searchParameters[searchConfig.key][term].enabled && terms.indexOf(term) < 0) {
            app.updateSearchParameterAndNotify(searchConfig.key, term, searchConfig.title, false);
          }
        });

        terms.forEach(function(term) {
          if(term) {
            app.updateSearchParameterAndNotify(searchConfig.key, term, searchConfig.title, true);
          }
        });
      };

      app.updateDateAndNotify = function(key, date, text, category, enabled) {
        this.searchParameters.postingDate[key] = {
          key: key,
          category: category,
          enabled: enabled,
          date: date,
          text: text
        };

        this.notifyPath(['searchParameters', 'postingDate', key], {
          key: key,
          category: category,
          enabled: enabled,
          date: date,
          text: text
        });
      };

      app.updateDateParameterFromField = function(dateConfig) {
        if(dateConfig.value[dateConfig.key]) {
          var dateObject = dateConfig.value[dateConfig.key];
          app.updateDateAndNotify(dateObject.key, dateObject.date, dateObject.text, dateObject.category, dateObject.enabled);
        } else if(app.searchParameters.postingDate[dateConfig.key]) {
          app.searchParameters.postingDate[dateConfig.key] = {};
          app.notifyPath(['searchParameters', 'postingDate', dateConfig.key], {});
        }
      };

      app.updateSearchParametersFromFields = function() {
        this.searchFields.forEach(function(searchConfig) {
          app.updateSearchParameterFromField(searchConfig);
        });

        app.updateDateParameterFromField(app.dateStartConfig);
        app.updateDateParameterFromField(app.dateEndConfig);
      };

      app.updateSearchFieldFromParameter = function(searchConfig, index) {
        searchConfig.value = _.keys(app.searchParameters[searchConfig.key]).filter(function(term) {
          return app.searchParameters[searchConfig.key][term].enabled;
        }).map(function(term) {
          return app.searchParameters[searchConfig.key][term].text;
        }).join(', ');

        // Must update both the property value and the input element value!
        app.set(['searchFields', index, 'value'], searchConfig.value);
        document.querySelector('#input_' + searchConfig.key).value = searchConfig.value;
      };

      app.updateDateFieldFromParameter = function(dateConfig, property) {
        dateConfig.value = {};
        if(app.searchParameters.postingDate[dateConfig.key]) {
          dateConfig.value[dateConfig.key] = app.searchParameters.postingDate[dateConfig.key];
        }
        app.set([property + '.value'], dateConfig.value);
      };

      app.toggleSearchFieldsDialog = function() {
        // Set or clear the search fields whenever the dialog is opened.
        if(!this.searchFieldsDialogOpened) {
          this.searchFields.forEach(function(searchConfig, index) {
            app.updateSearchFieldFromParameter(searchConfig, index);
          });

          app.updateDateFieldFromParameter(app.dateStartConfig, 'dateStartConfig');
          app.updateDateFieldFromParameter(app.dateEndConfig, 'dateEndConfig');
        }

        this.searchFieldsDialogOpened = !this.searchFieldsDialogOpened;
      };

      app.handleSearch = function() {
        app.updateSearchParametersFromFields();

        if(app.noSearchParameters()) {
          return;
        }

        app.toggleSearchFieldsDialog();
      };

      app.resetSearchFields = function() {
        this.searchFields.forEach(function(searchConfig, index) {
          // Must update both the property value and the input element value!
          app.set(['searchFields', index, 'value'], '');
          document.querySelector('#input_' + searchConfig.key).value = '';
        });

        app.dateStartConfig.value = {};
        app.set('dateStartConfig.value', {});
        app.dateEndConfig.value = {};
        app.set('dateEndConfig.value', {});
      };

      // clear tempSeachParameters and close dialog when user cancels
      app.cancelSearch = function() {
        app.userCanceled = true;
        app.toggleSearchFieldsDialog();
      };
      /* end search dropdown panel code */

      app.getElasticTypes = function() {
        return ['microcap'];
      };

      app.noSearchParameters = function() {
        return DigBehaviors.FilterBehavior.areAllDisabled(this.searchParameters, ['sort']);
      };

      /**
       * Opens or closes the facet list corresponding to the ID of the element that triggered the event.
       */
      app.toggleList = function(event) {
        if(event.target.parentElement && event.target.parentElement.id) {
          var type = event.target.parentElement.id;
          if(this.$[type + '-list']) {
            this.$[type + '-list'].toggle();
            this.$[type + '-icon-closed'].style.display = (this.$[type + '-icon-closed'].style.display !== 'none' ? 'none' : '');
            this.$[type + '-icon-opened'].style.display = (this.$[type + '-icon-opened'].style.display !== 'none' ? 'none' : '');
          }
        }
      };

      app.toggleAllFacetLists = function() {
        app.facetListsExpanded = !app.facetListsExpanded;
        // All facet lists should have the class 'facet' and an id
        var allFacetListNames = document.querySelectorAll('.facet');

        for(var i = 0, length = allFacetListNames.length; i < length; i++) {
          if(allFacetListNames[i].id) {
            var name = allFacetListNames[i].id;
            this.$[name + '-list'].opened = app.facetListsExpanded;
            this.$[name + '-icon-closed'].style.display = app.facetListsExpanded ? 'none' : '';
            this.$[name + '-icon-opened'].style.display = (!app.facetListsExpanded) ? 'none' : '';
          }
        }
      };

      app.getToggleAllFacetsText = function() {
        return (app.facetListsExpanded ? 'Collapse' : 'Expand') + ' All';
      };

      app.getToggleAllFacetsIcon = function() {
        return (app.facetListsExpanded ? 'icons:expand-less' : 'icons:expand-more');
      };

      app.getLabelAndCount = function(name, list) {
        return name + (list.length ? (list.length >= 10 ? ' (Top 10)' : ' (' + list.length + ')') : '');
      };

      app.toggleProcessRequest = function() {
        app.processRequest = !app.searchFieldsDialogOpened && !app.userCanceled;
        // reset user canceled variable
        app.userCanceled = false;
      };

      app.checkSearchFieldInputKey = function(event) {
        if(event.keyCode === 13) {
          app.handleSearch();
        }
      };
    })(document);
  </script>
</body>

</html>
